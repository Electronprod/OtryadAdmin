<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Список отряда</title>
	<link rel="stylesheet" href="/assets/tablemgr.css">
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
</head>

<body>
	<!--CSRF Attack Protection (Getting from thymeleaf for JS)-->
	<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
	<table>
		<thead>
			<tr>
				<th>ID</th>
				<th>Имя</th>
				<th>Фамилия</th>
				<th>Отчество</th>
				<th>Д. Р.</th>
				<th>Школа</th>
				<th>Класс</th>
				<th>Буква</th>
				<th>Адрес</th>
				<th>Телефон</th>
				<th>Вступление</th>
				<th>Посвящение</th>
				<th>Мама</th>
				<th>Папа</th>
				<th>Звено</th>
			</tr>
		</thead>
		<tbody>
			<tr th:each="human : ${humans}">
				<td th:text="${human.id}"></td>
				<td th:text="${human.name}"></td>
				<td th:text="${human.lastname}"></td>
				<td th:text="${human.surname}"></td>
				<td th:text="${human.birthday}"></td>
				<td th:text="${human.school}"></td>
				<td th:text="${human.classnum}"></td>
				<td th:text="${human.classchar}"></td>
				<td th:text="${human.address}"></td>
				<td th:text="${human.phone}"></td>
				<td th:text="${human.year_of_admission}"></td>
				<td th:text="${human.dedicated}"></td>
				<td th:text="${human.mother}"></td>
				<td th:text="${human.father}"></td>
				<td th:text="${human.squadid}"></td>
			</tr>
		</tbody>
	</table>
	<div class="bottomPanel">
		<button class="btn" onclick="addF();">Добавить</button>
		<button class="btn" onclick="deleteF();">Удалить</button>
		<button class="btn" onclick="editF();">Редактировать</button>
	</div>
</body>
<script>
	var csrfToken = document.querySelector('input[name="_csrf"]').value;
	if (window.location.href.includes("deleted")) {
		Swal.fire({
			title: "Готово!",
			text: "Человек удален.",
			icon: "success"
		});
	}
	if (window.location.href.includes("added")) {
		Swal.fire({
			title: "Готово!",
			text: "Человек сохранен.",
			icon: "success"
		});
	}
	if (window.location.href.includes("edit")) {
		Swal.fire({
			title: "Готово!",
			text: "Человек отредактирован.",
			icon: "success"
		});
	}
	if (window.location.href.includes("error")) {
		Swal.fire({
			title: "Произошла ошибка!",
			text: "Попробуйте еще раз.",
			icon: "error"
		});
	}
	if (window.location.href.includes("errorsquad")) {
		Swal.fire({
			title: "Произошла ошибка!",
			text: "Звено не было найдено!",
			icon: "error"
		});
	}
	function addF() {
		window.location.href = '/admin/humanmgr/add';
	}
	function editF() {
		Swal.fire({
			title: 'Введите ID',
			input: 'number',
			inputAttributes: {
				step: '1',
				min: '1'
			},
			showCancelButton: true,
			confirmButtonText: 'Редактировать',
			showLoaderOnConfirm: true,
			preConfirm: (number) => {
				if (!number || number % 1 !== 0) {
					Swal.showValidationMessage('ID - целое число!');
				}
			}
		}).then((result) => {
			if (result.value) {
				window.location.href = '/admin/humanmgr/edit?id=' + encodeURIComponent(result.value);
			}
		});
	}
	function deleteF() {
		Swal.fire({
			title: 'Введите ID',
			input: 'number',
			inputAttributes: {
				step: '1',
				min: '1'
			},
			showCancelButton: true,
			confirmButtonText: 'Удалить',
			showLoaderOnConfirm: true,
			preConfirm: (number) => {
				if (!number || number % 1 !== 0) {
					Swal.showValidationMessage('ID - целое число!');
				}
			}
		}).then((result) => {
			if (result.value) {
				window.location.href = '/admin/humanmgr/delete?id=' + encodeURIComponent(result.value);
			}
		});
	}
</script>

</html>