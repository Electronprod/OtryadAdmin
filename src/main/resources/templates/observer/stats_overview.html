<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Статистика</title>
<link rel="stylesheet" href="/assets/default_style.css">
<script defer src="/assets/navbar.js"></script>
<link rel="icon" href="/icon.png">
<script src="/public_resources/sweetalert2.js"></script>
<style>
.blue-btn {
	background-color: #6363ff;
}

.blue-btn:hover {
	background-color: #3a3ae0;
}
</style>
</head>

<body onresize="onResize()" onload="onResize()">
	<!--CSRF Attack Protection-->
	<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
	<div id="dashboard">
		<div id="content">
			<div class="card">
				<h3>
					Добро пожаловать, <span th:text="${name}"></span>!
				</h3>
				<p>Это ваша панель наблюдателя. Сверху вы можете перейти в другие разделы сайта. Снизу находятся данные о
					статистике. Приятного пользования!</p>
				<div th:if="${user_role == 'ROLE_ADMIN'}">
					<a href="/admin" class="admin-button">Вернуться в панель администратора</a>
				</div>
				<div th:if="${user_role == 'ROLE_COMMANDER'}">
					<a href="/commander/stats" class="admin-button">Вернуться в панель командира</a>
				</div>
			</div>
			<div class="cardc-container">
				<div class="cardc">
					<h3>Общая статистика</h3>
					<p>
						<b>Всего ребят:</b> <span th:text="${people_size}"></span><br> <b>Количество пропусков:</b> <span
							th:text="${people_missed}"></span><br> <b>Количество посещений:</b> <span th:text="${people_attended}"></span>
					</p>
				</div>
				<div class="cardc">
					<h3>Статистика за сегодня</h3>
					<p>
						<b>Количество пропусков:</b> <span th:text="${people_missed_today}"></span><br> <b>Количество посещений:</b>
						<span th:text="${people_attended_today}"></span><br> <b>Сегодня ребят отметили:</b> <span
							th:text="${commanders_marked_today}"></span> командиров.
					</p>
				</div>
			</div>
			<div class="card">
				<h3>Просмотр отметок</h3>
				<p>Узнайте, кто и что отметил в выбранную дату - для этого введите ее в поле или выберите событие из списка
					недавних</p>
				<label>Недавние отметки</label>
				<div class="calendar-line"></div>
				<ul>
					<li><b>Наведитесь</b>, чтобы увидеть название события (только для ПК)</li>
					<li><b>Нажмите</b>, чтобы показать отметки в эту дату</li>
				</ul>
				<form id="date-form" action="/observer/stats/date">
					<label>Информация для: </label> <input name="date" id="mark_table_datepickr" type="date"
						onchange="loadMarkedUsersTable(formatDate(this.valueAsDate))"></input>
					<div id="marked"></div>
					<button id="showStatsByDate" type="submit">Показать таблицу отметок</button>
					<button class="form-btn blue-btn" type="button" onclick="window.location.href='/observer/demand'">Отправить
						напоминание</button>
				</form>
			</div>
			<div class="header">
				<h3>Статистика по структурам</h3>
			</div>
			<div class="card">
				<h3>Звеньевая статистика</h3>
				<p>
					Посмотрите статистику <u>звена</u>, кликнув на кнопку "перейти"
				</p>
				<table>
					<thead>
						<tr>
							<th>Название звена</th>
							<th>Командир</th>
							<th>Ребят</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="squad : ${squadList}">
							<td th:text="${squad.squadName}"></td>
							<td th:text="${squad.commander.name}"></td>
							<td th:text="${squad.humans.size()}"></td>
							<td>
								<button th:onclick="window.location.href='/observer/stats/squad/' + [[${squad.id}]];">Перейти к
									статистике</button>
						</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="card">
				<h3>Групповая статистика</h3>
				<p>
					Посмотрите статистику <u>группы</u>, кликнув на кнопку "перейти"
				</p>
				<table>
					<thead>
						<tr>
							<th>Название группы</th>
							<th>Управляет группой</th>
							<th>Ребят</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="group : ${all_groups}">
							<td th:text="${group.name}"></td>
							<td th:text="${group.marker.name}"></td>
							<td th:text="${group.humans.size()}"></td>
							<td>
								<button th:onclick="window.location.href='/observer/stats/group/' + [[${group.id}]];">Перейти к
									статистике</button>
						</td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="header">
				<h3>Персональная статистика</h3>
			</div>
			<div class="card">
				<h3>Просмотр персональной статистики</h3>
				<p>Показывает всю информацию о выбранном человеке.</p>
				<form method="get">
					<select name="id">
						<option th:each="human: ${humans}" th:value="${human.id}" th:text="${human.lastname} + ' ' + ${human.name}">
						</option>
					</select>
					<button class="form-btn" type="submit" formaction="/observer/stats/personal">Посмотреть</button>
					<button class="form-btn" type="submit" formaction="/observer/stats/personal/table">Посмотреть в виде
						таблицы</button>
				</form>
			</div>
			<div class="header">
				<h3>Отчет</h3>
			</div>
			<div class="card">
				<h3>По событию</h3>
				<p>Посмотрите, кто и сколько раз посетил выбранное событие или таблицу отметок для этого события</p>
				<form method="get">
					<label for="event_name">Выберите событие:</label> <select id="event_name" name="event_name">
						<option th:each="event : ${events}" th:value="${event}" th:text="${event}"></option>
					</select>
					<button class="form-btn" type="submit" formaction="/observer/stats/report">Посмотреть посещаемость</button>
					<button class="form-btn" type="submit" formaction="/observer/stats/event_table">Посмотреть таблицу отметок</button>
				</form>
			</div>
			<div class="card">
				<h3>По всем отметкам</h3>
				<p>Показывает посещаемость ребят в рамках всех отметок.</p>
				<a class="form-btn" href="/observer/stats/report_all?include_groups=false">Посмотреть без групп</a> <a
					class="form-btn" href="/observer/stats/report_all?include_groups=true">Посмотреть с группами</a>
			</div>
			<div class="header">
				<h3>Дополнительно</h3>
			</div>
			<div class="card" th:if="${user_role == 'ROLE_HEAD' || user_role == 'ROLE_ADMIN'}">
				<h3>Прием новых ребят</h3>
				<p>Здесь вы можете в удобной форме сохранять информацию о кандидатах, пожелавших вступить в отряд, а также
					просматривать или экспортировать эти данные.</p>
				<a href="/head/collector/data" class="greenbtn">Перейти в приемную</a>
			</div>
			<div class="card">
				<h3>Просмотр всех отметок</h3>
				<p>
					Показывает таблицу со всеми отметками, которые были проставлены за время существования БД. <br> <b>Не
						использовать без нужды! Сильно нагружает сервер и ваш компьютер.</b>
				</p>
				<a class="greenbtn" style="background-color: red" href="/observer/stats/table">Получить таблицу</a>
			</div>
		</div>
	</div>
	<script src="/assets/calendar-line.js"></script>
	<script src="/onepage_scripts/observer.js"></script>
</body>
</html>